<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Minimal concurrent OS</title>
<meta name="author" content="Daníel Grétarsson and Ólafur Bogason"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./css/reveal.css"/>

<link rel="stylesheet" href="./css/theme/black.css" id="theme"/>

<link rel="stylesheet" href="./presentations.css"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = './css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide">
<h1 class="title">Minimal concurrent OS</h1><h2 class="author">Daníel Grétarsson and Ólafur Bogason</h2>
</section>

<section>
<section id="slide-org3a5e6e7">
<h2 id="org3a5e6e7"></h2>
<iframe width="600px" height="200px" src="https://www.youtube.com/embed/O2R4R_EebBk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

</section>
<section id="slide-org1d0d189">
<h3 id="org1d0d189">Who are we?</h3>
<p>
Engineers at Genki Instruments, creators of <b>Wave</b>, an expressive embedded device for music and beyond.
</p>

<p>
In engineering-speak that means developing everything from  <b>hardware</b> and <b>firmware</b> to <b>algorithms</b> and <b>software</b> for end-users.
</p>

<p>
We mainly use <b>C++</b>, but curious about other systems-level languages. We strive for <b>clean</b>, <b>readable</b> code.
</p>

</section>
</section>
<section>
<section id="slide-org36d18ac">
<h2 id="org36d18ac">Goal</h2>
<p>
Build boilerplate for a minimal (event driven) <b>concurrent</b> OS.
</p>

<p>
It should run on bare-metal and have a <b>single thread of execution</b>.
</p>

<p>
Inspired by our own attempts at building reliable firmware for Wave.
</p>

</section>
</section>
<section>
<section id="slide-org4970d01">
<h2 id="org4970d01">Constraints</h2>
<ul>
<li>Processing power and memory limited.</li>
<li><i>Soft</i> real time (cooperative scheduler) &#x2013; tasks operate on deadlines that don't cause fatalities if not met.</li>
<li>No Dynamic Memory &#x2013; we can't ever <i>run out</i>.</li>
<li>No Exceptions &#x2013; exceptions are nondeterministic, hard to handle.</li>
<li>Catch bugs at <b>compile</b> time as opposed to <b>run</b> time.</li>
<li>Development times, maintainability etc.</li>

</ul>

</section>
</section>
<section>
<section id="slide-orgeb14a74">
<h2 id="orgeb14a74">Why C++17/20?</h2>
<div class="outline-text-2" id="text-orgeb14a74">
</div>
</section>
<section id="slide-orgadce3fd">
<h3 id="orgadce3fd">Type safety</h3>
</section>
<section id="slide-org3e8f970">
<h3 id="org3e8f970">Language features</h3>
<ul>
<li><code>RAII</code> &#x2013; Deterministic way to manage resources.</li>
<li><code>Templates</code> &#x2013; Generic compile-time programming.</li>
<li><code>lambdas</code> &#x2013; Dependency injected, compile-time glue.</li>
<li><code>namespaces</code> &#x2013; Group together similar code</li>
<li><p>
<code>std::variant / visit</code> &#x2013; Type-safe <i>dynamic</i> dispatch.
</p>

<p>
&#x2026;and many more!
</p></li>

</ul>

</section>
<section id="slide-orgbe142fe">
<h3 id="orgbe142fe">Active developer community</h3>
<ul>
<li><a href="https://github.com/boost-experimental/sml">boost::sml (State Machine Library)</a> &#x2013; Domain Specific Language for writing FSMs.</li>
<li><a href="https://en.cppreference.com/w/">stl (Standard Template Library)</a> &#x2013; Useful algorithms, types and containers.</li>
<li><a href="https://www.etlcpp.com/">etl (Embedded Template Library)</a> &#x2013; Fixed-size containers.</li>
<li><a href="https://github.com/Microsoft/GSL">gsl (Guidelines Support Library)</a> &#x2013; <code>gsl::byte</code> and <code>gsl::span</code> <i>view</i> into raw memory.</li>

</ul>

</section>
</section>
<section>
<section id="slide-orgdb9c874">
<h2 id="orgdb9c874">Core concepts</h2>
</section>
</section>
<section>
<section id="slide-org4f4d225">
<h2 id="org4f4d225">Interrupts/Events</h2>
<ul>
<li><b>Interrupts</b> are the lowest level of abstraction. Arise directly from hardware, halting execution.</li>
<li><b>Events</b> are the <i>meaningful</i> encoding of <b>interrupts</b>, e.g., read sensor, react to pin change.</li>

</ul>
<div class="org-src-container">

<pre  class="src src-C++"><span style="color: #4f97d7; font-weight: bold; font-style: italic;">namespace</span> <span style="color: #a45bad;">events</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7; font-weight: bold; font-style: italic;">struct</span> <span style="color: #ce537a; font-weight: bold;">data</span> <span style="color: #bc6ec5;">{</span> <span style="color: #a45bad;">std</span>::<span style="color: #ce537a; font-weight: bold;">array</span><span style="color: #2d9574;">&lt;</span><span style="color: #a45bad;">std</span>::byte, MaxPacketSize<span style="color: #2d9574;">&gt;</span> <span style="color: #7590db;">packet</span>; <span style="color: #bc6ec5;">}</span>;
<span style="color: #4f97d7; font-weight: bold; font-style: italic;">struct</span> <span style="color: #ce537a; font-weight: bold;">button</span> <span style="color: #bc6ec5;">{</span> <span style="color: #ce537a; font-weight: bold;">uint8_t</span> <span style="color: #7590db;">id</span>; <span style="color: #ce537a; font-weight: bold;">bool</span> <span style="color: #7590db;">toggle_state</span>; <span style="color: #bc6ec5;">}</span>;
  
<span style="color: #4f97d7; font-weight: bold; font-style: italic;">using</span> <span style="color: #ce537a; font-weight: bold;">var_t</span> = <span style="color: #a45bad;">std</span>::<span style="color: #ce537a; font-weight: bold;">variant</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #ce537a; font-weight: bold;">data</span>, <span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #ce537a; font-weight: bold;">button</span><span style="color: #bc6ec5;">&gt;</span>;
<span style="color: #4f97d7; font-weight: bold; font-style: italic;">using</span> <span style="color: #ce537a; font-weight: bold;">queue</span> = <span style="color: #a45bad;">etl</span>::<span style="color: #ce537a; font-weight: bold;">queue</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">var_t</span>, MaxEventQueueSize<span style="color: #bc6ec5;">&gt;</span>;
<span style="color: #4f97d7;">}</span>

<span style="color: #a45bad;">events</span>::<span style="color: #ce537a; font-weight: bold;">queue</span> <span style="color: #7590db;">event_queue</span><span style="color: #4f97d7;">{}</span>;

<span style="color: #4f97d7; font-weight: bold; font-style: italic;">static</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">pin_handler</span><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #ce537a; font-weight: bold;">uint8_t</span> <span style="color: #7590db;">pin_id</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span> event_queue.push<span style="color: #bc6ec5;">(</span><span style="color: #a45bad;">events</span>::button<span style="color: #2d9574;">{</span>pin_id, gpio_pin_read<span style="color: #67b11d;">(</span>pin_id<span style="color: #67b11d;">)</span><span style="color: #2d9574;">}</span><span style="color: #bc6ec5;">)</span>; <span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold; font-style: italic;">static</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">data_receive_handler</span><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #ce537a; font-weight: bold;">uint8_t</span>* <span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #7590db;">bytes</span>, <span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #ce537a; font-weight: bold;">size_t</span> <span style="color: #7590db;">size</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">events</span>::<span style="color: #ce537a; font-weight: bold;">data</span> <span style="color: #7590db;">event</span><span style="color: #bc6ec5;">{}</span>;
    <span style="color: #a45bad;">std</span>::copy<span style="color: #bc6ec5;">(</span>bytes, bytes + size, event.packet.begin<span style="color: #2d9574;">()</span><span style="color: #bc6ec5;">)</span>;
    event_queue.push<span style="color: #bc6ec5;">(</span>event<span style="color: #bc6ec5;">)</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</section>
</section>
<section>
<section id="slide-org212d3ee">
<h2 id="org212d3ee">Message passing (dispatching)</h2>
<ul>
<li><p>
<b>Message passing</b> is a form of communication accomplished by queuing <b>events</b>.
</p>

<p>
<code>std::variant</code> offers <b>many</b> ways to achieve dynamic dispatch, e.g.,  <code>std::holds_alternative</code> + <code>std::get</code> (exceptional), <code>std::get_if</code>, <code>std::visit</code>&#x2026;
</p></li>

</ul>
</section>
<section id="slide-org5bc8402">
<h3 id="org5bc8402"></h3>
<iframe width="800px" height="200px" src="https://godbolt.org/#g:!((g:!((g:!((h:codeEditor,i:(j:1,lang:c%2B%2B,source:'%23include+%3Cvariant%3E%0A%0Avoid+handle_int()%3B%0Avoid+handle_float()%3B%0A%0Aint+main(int+argc,+char**+argv)%0A%7B%0A++++std::variant%3Cint,+float%3E+v%3B%0A%0A++++if+(argc+%3D%3D++2)+%7B%0A++++++++v+%3D+42%3B%0A++++%7D+else++%7B%0A++++++++v+%3D+42.0f%3B%0A++++%7D%0A%0A++++if+(auto*+p+%3D+std::get_if%3Cint%3E(%26v))+%7B%0A++++++++handle_int()%3B%0A++++%7D+else+if+(auto*+p+%3D+std::get_if%3Cfloat%3E(%26v))+%7B%0A++++++++handle_float()%3B%0A++++%7D%0A%0A++++return+0%3B%0A%7D%0A'),l:'5',n:'0',o:'C%2B%2B+source+%231',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:armg820,filters:(b:'0',binary:'1',commentOnly:'0',demangle:'1',directives:'0',execute:'1',intel:'0',libraryCode:'1',trim:'1'),lang:c%2B%2B,libs:!(),options:'-std%3Dc%2B%2B17+-O3+-fno-exceptions',source:1),l:'5',n:'0',o:'ARM+gcc+8.2+(Editor+%231,+Compiler+%231)+C%2B%2B',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4"></iframe>

<div class="org-src-container">

<pre  class="src src-:export">#include &lt;variant&gt;

// creates helper type for the variant visitor
template&lt;class... Ts&gt; struct visitor : Ts... { using Ts::operator()...; };
template&lt;class... Ts&gt; visitor(Ts...) -&gt; visitor&lt;Ts...&gt;;

// struct visitor {
//     void operator()(const int&amp; v) {};
//     void operator()(const float&amp; v) {};
// };

void handle_int();
void handle_float();

int main(int argc, char** argv)
{
    std::variant&lt;int, float&gt; v;

    if (argc ==  2) {
        v = 42;
    } else  {
        v = 42.0f;
    }

    std::visit(visitor{
        [&amp;](const int&amp;) { handle_int(); },
        [&amp;](const float&amp;) { handle_float(); },
        }, v);

    return 0;
}
</pre>
</div>

</section>
<section id="slide-org404020d">
<h3 id="org404020d"></h3>
<iframe width="800px" height="200px" src="https://godbolt.org/#g:!((g:!((g:!((h:codeEditor,i:(j:1,lang:c%2B%2B,source:'%23include+%3Cvariant%3E%0A%0A//+creates+helper+type+for+the+variant+visitor%0Atemplate%3Cclass...+Ts%3E+struct+visitor+:+Ts...+%7B+using+Ts::operator()...%3B+%7D%3B%0Atemplate%3Cclass...+Ts%3E+visitor(Ts...)+-%3E+visitor%3CTs...%3E%3B%0A%0A//+struct+visitor+%7B%0A//+++++void+operator()(const+int%26+v)+%7B%7D%3B%0A//+++++void+operator()(const+float%26+v)+%7B%7D%3B%0A//+%7D%3B%0A%0Avoid+handle_int()%3B%0Avoid+handle_float()%3B%0A%0Aint+main(int+argc,+char**+argv)%0A%7B%0A++++std::variant%3Cint,+float%3E+v%3B%0A%0A++++if+(argc+%3D%3D++2)+%7B%0A++++++++v+%3D+42%3B%0A++++%7D+else++%7B%0A++++++++v+%3D+42.0f%3B%0A++++%7D%0A%0A++++std::visit(visitor%7B%0A++++++++%5B%26%5D(const+int%26)+%7B+handle_int()%3B+%7D,%0A++++++++%5B%26%5D(const+float%26)+%7B+handle_float()%3B+%7D,%0A++++++++%7D,+v)%3B%0A%0A++++return+0%3B%0A%7D%0A'),l:'5',n:'0',o:'C%2B%2B+source+%231',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:armg820,filters:(b:'0',binary:'1',commentOnly:'0',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'1',trim:'1'),lang:c%2B%2B,libs:!(),options:'-std%3Dc%2B%2B17+-O3+-fno-exceptions',source:1),l:'5',n:'0',o:'ARM+gcc+8.2+(Editor+%231,+Compiler+%231)+C%2B%2B',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4"></iframe>

</section>
<section id="slide-org26760de">
<h3 id="org26760de">Considerations</h3>
<dl>
<dt><code>std::get_if</code></dt><dd>Smaller binary, performant.</dd>
<dt><code>std::visit</code></dt><dd>Larger binary, extra <code>cmp</code>, nice syntax, exhaustive.</dd>

</dl>

</section>
</section>
<section>
<section id="slide-orgf256f0b">
<h2 id="orgf256f0b">Tasks / Scheduler</h2>
<ul>
<li>A <b>task</b> is an abstraction that represents some processing unit.</li>
<li>A <b>scheduler</b> runs <b>tasks</b> from the <b>main context</b> (!)</li>

</ul>
</section>
<section id="slide-orga8d49e5">
<h3 id="orga8d49e5"></h3>
<iframe width="800px" height="200px" src="https://godbolt.org/#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAKxAEZSAbAQwDtRkBSAJgCFufSAZ1QBXYskwgA5NwDMeFsgYisAag6yAwgREAHBpg3YOABgCCpswUwBbfU2sbtAT12YWTG5gB0v1WeJgQVJVAld3T0xVADERRRDBAnQQEEE8AC9MAH0CX29VAEl0AA8jSwA3VDx0VQAzEizMJmQELLw7Bgg0FkTVROSQHX1DLQCgvLKuADZQkNjFbinFuoSklIUsYqzBTABHEXcJJyLiidlsAEp1AHY%2Bc1UH1QhaiH6U4EwCY5KjCAILi4hPIXDR3CzXAAilks1g6DhGLjcHi8qgAKnoDCEwkjIjEyuZuolMMVdMRVJVqnUGk0WhB0cNFsshpi8dNlrUQbdLI9VITrCSyW9UhlsgRVAA5dSyCF9NaDDHZNKZJxC4i2VDlbJq2qYNWKUVOekGMrnFLlJjKEZgnn1YiNZqtdr6V5y20AdyYxHQhoVv2ZmEBsoG7s93q00V%2BHNI3J5sYeQpsTAA1tkNsTtnsDvqnOKylzISDZGCOJDoeYKTUEKx0AY2iwCBBC2CK6oqywa9lagxUA5G6DLAAjVCoBihJiCJNZLhZYhxFgKYB9otlswKMWJhSNm7Wx6VZgEPAGVRDkd9FqYdAiAx22csedsKUygizq0xh57hyHqIn0cEceT2gZznBdH1CF9%2B3MN9VAAemgtFkyiBRVFEaxiAAWkENA3FUcdVG1XVDkMe5Hj5HCRCIMcJyyWhQI4ABWPg2TomUSx3ONSKYcjUFUFhMAvQQsjdEgk1ohjGWY7c8M%2BMQWEogCgLvBdQRuKFl2I9jUB6MVOIo0lUAkQQBKE4gRI0FixOY1jW2rWsux7BsmxUiCLHU2M1R0YhZITBCsl0Jg8GICBeP4wThJCPSDKM4SmygktVOLVyOK4uSp1EvgJNYqCeSSijgvQKKTLS%2BiWNuKSPNkv8qOnW970XRy4ucuMHhy7iIswQzQsKsz1AsqFSrbDs6wc5SGrUlyzCasqZKDFJExTXz/MCvKCqTcLiH09qVpi1zRoSiaSM03odO4yrJwYPBem67z5v9P5/2orF7q4bbxp5N0EC/J5MIQC8r11BTaquTLXJtakHTuqjzsSEJ6PSiEukO7SuKZf8ga5EGmpa2Hls61bVDajrjKTYrQNOpc9smt6PqPIK%2BPy3HGzRtjKZ5AmVvJrKmoajGHjil6eW517Hnc6aTGcwWpEBBhpDoqRSBYaQTDl1BpE0fh%2BD6URxCiORaDlghFclwEkxAOiTEYaQABY5YVqQldIFWpDlwQQHNg27cl0g4FgJA0DsL8yAoBH/evEBPRsYAAA4uHN2pD1Ql2IAHQ3SAHBRPWcaQ9dIP2vHrAB5FgGEzj3SCwRM2AMFP8DVZAD01F3S%2BJTBkHIyQpGztdMGl0vzoHYgM80DB2%2Bz592izz3mDYFB1d4Rg8AHF3IEBVBdAPQ7pAwpIzM4Xh%2BFoa5VDQ/PZCP2oWFQNDiQkNe8EO52tYkOgpZlm2U8dswACUAFlVGAZBkCqEjt4LgTxcCEBIOoLgsh6CqCHiHXUUCYFXDVnvXg%2BtDYAlID9JgWBiCUGNqbc2Pdrby3ftIZ2rtSDuyVlgnuXA36l0dhgj2WDNTEDSJpEAlsgA%3D%3D%3D"></iframe>

<div class="org-src-container">

<pre  class="src src-:export">#include &lt;tuple&gt;

template&lt;typename... Args, typename Func, std::size_t... Idx&gt;
void for_each_impl(const std::tuple&lt;Args...&gt;&amp; t, Func&amp;&amp; f, std::index_sequence&lt;Idx...&gt;) {
    (f(std::get&lt;Idx&gt;(t)), ...);
}

template&lt;typename Tuple, typename F&gt;
constexpr void for_each(Tuple&amp;&amp; tuple, F&amp;&amp; f){
    constexpr std::size_t N = std::tuple_size&lt;std::remove_reference_t&lt;Tuple&gt;&gt;::value;
    for_each_impl(std::forward&lt;Tuple&gt;(tuple), std::forward&lt;F&gt;(f),
            std::make_index_sequence&lt;N&gt;{});
}

void handle_int();
void handle_float();

int main(int argc, char** argv) {
    volatile bool scheduler_running = true;
    volatile bool task_1_running = true;
    volatile bool task_2_running = true;

    const auto task_1 = [&amp;] {
        const auto needs_work = [&amp;] { return task_1_running; };
        const auto process_work = [&amp;]{ handle_float(); };

        return std::make_pair(needs_work, process_work);
    };

    const auto task_2 = [&amp;] {
        const auto needs_work = [&amp;] { return task_2_running; };
        const auto process_work = [&amp;]{ handle_int(); };

        return std::make_pair(needs_work, process_work);
    };

    const auto task_list = std::make_tuple(task_1, task_2);

    while (scheduler_running) {
        for_each(task_list, [](const auto&amp; task) {
            const auto[needs_work, process_work] = task();

            while (needs_work()) {
                process_work();
            }
        });
    }

    return 0;
}
</pre>
</div>

</section>
</section>
<section>
<section id="slide-orgc2e5106">
<h2 id="orgc2e5106">Finite state machine</h2>
<ul>
<li><b>Finite state machines</b> describe and handle <b>business logic</b> or hardware functionality, e.g., button or battery monitoring.</li>

</ul>

</section>
<section id="slide-orgba764f1" data-background="#D3D3D3">
<h3 id="orgba764f1">Two-button shutdown</h3>

<div class="figure">
<p><object type="image/svg+xml" data="img/button_shutdown.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>

</section>
<section id="slide-org88b79f4">
<h3 id="org88b79f4"></h3>
<iframe width="800px" height="200px" src="https://godbolt.org/#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAKxAEZSAbAQwDtRkBSAJgCFufSAZ1QBXYskwgA5NwDMeFsgYisAag6yAwggIEADoJAB6I8SYB3AHTBCCEQCMRgzONQsCmd5bQBbI/dRUQQIAWkwADz0XPB9PAiYGI0EfRJ8mYJcjBSUVTH9A4KSUywQ9PQ1sDgAGAEE5bOU1DU1kYPx3Cuq62oA3VDx0VRE8AH0FfGQmDxHBOwJ0VHMWCABKDT5e/sHBAE8Mnxm5haXV9a6uliZYwT0mCVVMHrjBdQB2DZrVVWDiEWQCVSOXRuN48IYKAgADhGAIG60BgQYqiIwGADEwM3iHnhHFeABEzrVcQSibUfn8AQRzKgRkCiCxDiJ5osWKCul8vsEpnhkKo0CwMpFiOD3NCATwmfSABrqWR41RVQmfDlcgg8vluQV6YXDUUw1QS4EsACasvltCV7I5TCZqFUqCiZiIxFWqw1AoBuI%2BHJ9Q0ECmAqku11u9wCQQIIBAyQYSt9HKcAaDV0wNzumAeT3cgkttXjX35wVUNqIqjwghG4RG2tTzkGGnlHAArHwm3iIIWASXUNwAGwPFag1TETAEMSszCWAZmhsGyVuGV9vsPSwotEY1WYHH4uP5zvF21lis7asjwR1s3qFvN9v77vLzCDr3D0fjlfThuzw3001Lrj9yc13RTEpi3WQwWJXNlXjO9D3LSsRhHdF0kwes5SvVtb01LtbQfJ93hfMdiAnKc0IJdDvzcX9/2XMAwEA1BUWAzdt3I7092wg9S3gk8kMwFCyIwm8O04%2B9/wHIcRyIkiPzlL95xNdQaPEuiGKYjcsTAiCd3A848w4j0uLtWYmWOVlZ2bTCh12fZGWZE41nAt42L06DfVg7iWAmUC7LMy9LJvIdhjGLyeR8kz7OWRztJc0k3J9KS3zSABrDECDMAVCDwNwYSYex0QgK183jAAqbguBYNwMRrc9UPKmYlLBR44maOk3E6Ft4KrGq60CiyuC4bqz16gaZlIIrit9crKpYarhrq0aXn4TMWq0NqWA6ngeNPWs6rbfyBpPHqFq4MbXMm/NyqG3b0HqpbeBWjo1oUzausQzBkN6/b%2Boqqqdtq27FvG/SLp9cqjvmwHTvupqswIVqXtkSpOuPd7Pr2xt0Omv7jqhs64tBqaBuugG7sax74eeo1XtR3HAqMMtQsmaYIr8n6AgIBB/pG6Hgfi0Hwe5k6GuW5qns0daaYQun9oZ8YwpZo4WQOrgOa5umgfOwmOXKtWhbxmGKYR6mkcst6%2BIEvqsYGjxiB8BRuTYEYIZuu6%2Be1nWBr1jXofJsXKYlxHka21GLa%2BzHGxtlx7cuNUnZJnn8e6fmLvK22Y8d4BpchsnRbh436Slqsw4x1QGdZ5XZyld2PaUrh04duOs5d0nFr9/OqcL02UedtH%2BPDsvviVpZLylCafWiibIKJHSPi6CFVDSBQIAXphiGAZBSD5BA15Kkri3Xno1neCbw2CKMYwvnxmipGl1t8lkKm%2Ba/dJB74sR5EZ0mcYgCAgf0ABemBUAADN/4%2BCfHJdCtBaCTwJiqHwlhtSoAkOeEY/sID%2B0MCASW7wqhb3SiILc%2BI4FuWSEg4gKDazoLhpguG2DcE8HoMiX4xC8SkJ9OQ5BqCKwYKwVGRh%2BDVAgISM4YkHCEEUKoWgvh9CBEvXeMwkRDAxEkMtDuWoUgViMGkE2KQpAWDSCqPo1A0hND8GWsIMQ9w5C0H0ZGKQxiVjaOSiAJs%2BCGDSAACz6MMY4kx0h9GGHwQ4pxpA4CwCQL4PQeB0RkAoCJHwMS4kgDXj4YAkIuD4JAbE22hgID2CMfo%2BwDtiA7GkHY0gvhYjuAAPIsAYOU/xpAsBpDYOiIpLS8Ajn%2BHgJ4hhmkREwMgJkkgpCVIhB9TpDA8D2DMGUzQGAxmVPSjECpWjGCsHYBY3gjBZmGEgNoh0apNTSBCG0BsnBeD8FoK8VQIRamyHuSAyqYRwgSD0CcgUQTRDiEkLAnRUg9EGM6aYqQNQABKABZVQG9eSQksFwVQEBcCEBIEpWQzDFlJNiS4DFsDVDmOubwexRTnGkAQPxLAxBKAuLcR47xvjQWBKECAEJZLtGeKkFwJlzSwWkv8eSp4xB/RuBAF4oAA"></iframe>

<div class="org-src-container">

<pre  class="src src-C++"><span style="color: #bc6ec5;">#include</span> <span style="color: #4f97d7;"><a href="https://raw.githubusercontent.com/boost-experimental/sml/master/include/boost/sml.hpp&gt;
#include &lt;cstdint">&lt;</a></span><span style="color: #2d9574;"><a href="https://raw.githubusercontent.com/boost-experimental/sml/master/include/boost/sml.hpp&gt;
#include &lt;cstdint">https://raw.githubusercontent.com/boost-experimental/sml/master/include/boost/sml.hpp&gt;</a></span><a href="https://raw.githubusercontent.com/boost-experimental/sml/master/include/boost/sml.hpp&gt;
#include &lt;cstdint">
</a><span style="color: #bc6ec5;"><a href="https://raw.githubusercontent.com/boost-experimental/sml/master/include/boost/sml.hpp&gt;
#include &lt;cstdint">#include</a></span><a href="https://raw.githubusercontent.com/boost-experimental/sml/master/include/boost/sml.hpp&gt;
#include &lt;cstdint"> </a><span style="color: #bc6ec5;"><a href="https://raw.githubusercontent.com/boost-experimental/sml/master/include/boost/sml.hpp&gt;
#include &lt;cstdint">&lt;</a></span><span style="color: #2d9574;"><a href="https://raw.githubusercontent.com/boost-experimental/sml/master/include/boost/sml.hpp&gt;
#include &lt;cstdint">cstdint</a></span><span style="color: #bc6ec5;"><a href="https://raw.githubusercontent.com/boost-experimental/sml/master/include/boost/sml.hpp&gt;
#include &lt;cstdint">&gt;</a></span>

<span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">ui_indicate_shutdown</span><span style="color: #bc6ec5;">()</span>;
<span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">system_shutdown</span><span style="color: #bc6ec5;">()</span>;

<span style="color: #4f97d7; font-weight: bold; font-style: italic;">namespace</span> <span style="color: #a45bad;">events</span> <span style="color: #bc6ec5;">{</span>
  <span style="color: #4f97d7; font-weight: bold; font-style: italic;">struct</span> <span style="color: #ce537a; font-weight: bold;">button</span> <span style="color: #2d9574;">{</span> <span style="color: #ce537a; font-weight: bold;">uint8_t</span> <span style="color: #7590db;">id</span>; <span style="color: #ce537a; font-weight: bold;">bool</span> <span style="color: #7590db;">toggle_state</span>; <span style="color: #2d9574;">}</span>;
<span style="color: #bc6ec5;">}</span>

<span style="color: #4f97d7; font-weight: bold; font-style: italic;">struct</span> <span style="color: #ce537a; font-weight: bold;">two_button_shutdown</span> <span style="color: #bc6ec5;">{</span>
    <span style="color: #4f97d7; font-weight: bold; font-style: italic;">static</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">constexpr</span> <span style="color: #ce537a; font-weight: bold;">uint8_t</span> <span style="color: #7590db;">ButtonX</span> = <span style="color: #a45bad;">0</span>;
    <span style="color: #4f97d7; font-weight: bold; font-style: italic;">static</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">constexpr</span> <span style="color: #ce537a; font-weight: bold;">uint8_t</span> <span style="color: #7590db;">ButtonY</span> = <span style="color: #a45bad;">1</span>;

    <span style="color: #4f97d7; font-weight: bold; font-style: italic;">auto</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">operator</span><span style="color: #2d9574; font-weight: bold;">()</span><span style="color: #2d9574;">()</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #2d9574;">{</span>
        <span style="color: #4f97d7; font-weight: bold; font-style: italic;">using</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">namespace</span> <span style="color: #a45bad;">boost</span>::<span style="color: #a45bad;">sml</span>;
        <span style="color: #4f97d7; font-weight: bold; font-style: italic;">using</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">namespace</span> <span style="color: #a45bad;">events</span>;

        <span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">auto</span> is_x_pressed = <span style="color: #67b11d;">[](</span><span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">auto</span>&amp; <span style="color: #7590db;">e</span><span style="color: #67b11d;">)</span> <span style="color: #67b11d;">{</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">return</span> e.id == ButtonX &amp;&amp; e.toggle_state; <span style="color: #67b11d;">}</span>;
        <span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">auto</span> is_y_pressed = <span style="color: #67b11d;">[](</span><span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">auto</span>&amp; <span style="color: #7590db;">e</span><span style="color: #67b11d;">)</span> <span style="color: #67b11d;">{</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">return</span> e.id == ButtonY &amp;&amp; e.toggle_state; <span style="color: #67b11d;">}</span>;

        <span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">auto</span> is_x_released = <span style="color: #67b11d;">[](</span><span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">auto</span>&amp; <span style="color: #7590db;">e</span><span style="color: #67b11d;">)</span> <span style="color: #67b11d;">{</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">return</span> e.id == ButtonY &amp;&amp; <span style="color: #a45bad;">!</span>e.toggle_state; <span style="color: #67b11d;">}</span>;
        <span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">auto</span> is_y_released = <span style="color: #67b11d;">[](</span><span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">auto</span>&amp; <span style="color: #7590db;">e</span><span style="color: #67b11d;">)</span> <span style="color: #67b11d;">{</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">return</span> e.id == ButtonY &amp;&amp; <span style="color: #a45bad;">!</span>e.toggle_state; <span style="color: #67b11d;">}</span>;

        <span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">auto</span> shutdown = <span style="color: #67b11d;">[]</span> <span style="color: #67b11d;">{</span> system_shutdown<span style="color: #b1951d;">()</span>; <span style="color: #67b11d;">}</span>;

        <span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #4f97d7; font-weight: bold; font-style: italic;">auto</span> indicate_shutdown = <span style="color: #67b11d;">[]</span> <span style="color: #67b11d;">{</span> ui_indicate_shutdown<span style="color: #b1951d;">()</span>; <span style="color: #67b11d;">}</span>;

        <span style="color: #4f97d7; font-weight: bold; font-style: italic;">return</span> make_transition_table<span style="color: #67b11d;">(</span>
               *<span style="color: #2d9574;">"none_pressed"</span>_s + <span style="color: #ce537a; font-weight: bold;">event</span><span style="color: #b1951d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">button</span><span style="color: #b1951d;">&gt;[</span><span style="color: #a45bad;">is_x_pressed</span><span style="color: #b1951d;">]</span> = <span style="color: #2d9574;">"x_pressed"</span>_s,
                <span style="color: #2d9574;">"none_pressed"</span>_s + <span style="color: #ce537a; font-weight: bold;">event</span><span style="color: #b1951d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">button</span><span style="color: #b1951d;">&gt;[</span><span style="color: #a45bad;">is_y_pressed</span><span style="color: #b1951d;">]</span> = <span style="color: #2d9574;">"y_pressed"</span>_s,

                <span style="color: #2d9574;">"x_pressed"</span>_s + <span style="color: #ce537a; font-weight: bold;">event</span><span style="color: #b1951d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">button</span><span style="color: #b1951d;">&gt;[</span><span style="color: #a45bad;">is_x_released</span><span style="color: #b1951d;">]</span> = <span style="color: #2d9574;">"none_pressed"</span>_s,
                <span style="color: #2d9574;">"y_pressed"</span>_s + <span style="color: #ce537a; font-weight: bold;">event</span><span style="color: #b1951d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">button</span><span style="color: #b1951d;">&gt;[</span><span style="color: #a45bad;">is_y_released</span><span style="color: #b1951d;">]</span> = <span style="color: #2d9574;">"none_pressed"</span>_s,

                <span style="color: #2d9574;">"x_pressed"</span>_s + <span style="color: #ce537a; font-weight: bold;">event</span><span style="color: #b1951d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">button</span><span style="color: #b1951d;">&gt;[</span><span style="color: #a45bad;">is_y_pressed</span><span style="color: #b1951d;">]</span> / indicate_shutdown = <span style="color: #2d9574;">"both_pressed"</span>_s,
                <span style="color: #2d9574;">"y_pressed"</span>_s + <span style="color: #ce537a; font-weight: bold;">event</span><span style="color: #b1951d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">button</span><span style="color: #b1951d;">&gt;[</span><span style="color: #a45bad;">is_x_pressed</span><span style="color: #b1951d;">]</span> / indicate_shutdown = <span style="color: #2d9574;">"both_pressed"</span>_s,

                <span style="color: #2d9574;">"both_pressed"</span>_s + <span style="color: #ce537a; font-weight: bold;">event</span><span style="color: #b1951d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">button</span><span style="color: #b1951d;">&gt;[</span><span style="color: #a45bad;">is_x_released</span><span style="color: #b1951d;">]</span> = <span style="color: #2d9574;">"terminating_y_pressed"</span>_s,
                <span style="color: #2d9574;">"both_pressed"</span>_s + <span style="color: #ce537a; font-weight: bold;">event</span><span style="color: #b1951d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">button</span><span style="color: #b1951d;">&gt;[</span><span style="color: #a45bad;">is_y_released</span><span style="color: #b1951d;">]</span> = <span style="color: #2d9574;">"terminating_x_pressed"</span>_s,

                <span style="color: #2d9574;">"terminating_x_pressed"</span>_s + <span style="color: #ce537a; font-weight: bold;">event</span><span style="color: #b1951d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">button</span><span style="color: #b1951d;">&gt;[</span><span style="color: #a45bad;">is_x_released</span><span style="color: #b1951d;">]</span> / shutdown = X,
                <span style="color: #2d9574;">"terminating_y_pressed"</span>_s + <span style="color: #ce537a; font-weight: bold;">event</span><span style="color: #b1951d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">button</span><span style="color: #b1951d;">&gt;[</span><span style="color: #a45bad;">is_y_released</span><span style="color: #b1951d;">]</span> / shutdown = X
        <span style="color: #67b11d;">)</span>;
    <span style="color: #2d9574;">}</span>
<span style="color: #bc6ec5;">}</span>;

<span style="color: #ce537a; font-weight: bold;">int</span> <span style="color: #bc6ec5; font-weight: bold;">main</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">int</span> <span style="color: #7590db;">argc</span>, <span style="color: #ce537a; font-weight: bold;">char</span>** <span style="color: #7590db;">argv</span><span style="color: #bc6ec5;">){</span>
    <span style="color: #a45bad;">boost</span>::<span style="color: #a45bad;">sml</span>::<span style="color: #ce537a; font-weight: bold;">sm</span><span style="color: #2d9574;">&lt;</span><span style="color: #ce537a; font-weight: bold;">two_button_shutdown</span><span style="color: #2d9574;">&gt;</span> <span style="color: #7590db;">sm</span>;
    static_assert<span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold; font-style: italic;">sizeof</span><span style="color: #67b11d;">(</span>sm<span style="color: #67b11d;">)</span> == <span style="color: #a45bad;">11</span><span style="color: #2d9574;">)</span>;

    sm.process_event<span style="color: #2d9574;">(</span><span style="color: #a45bad;">events</span>::button<span style="color: #67b11d;">{</span><span style="color: #a45bad;">0</span>, <span style="color: #a45bad;">true</span><span style="color: #67b11d;">}</span><span style="color: #2d9574;">)</span>;
    sm.process_event<span style="color: #2d9574;">(</span><span style="color: #a45bad;">events</span>::button<span style="color: #67b11d;">{</span><span style="color: #a45bad;">1</span>, <span style="color: #a45bad;">true</span><span style="color: #67b11d;">}</span><span style="color: #2d9574;">)</span>;
    sm.process_event<span style="color: #2d9574;">(</span><span style="color: #a45bad;">events</span>::button<span style="color: #67b11d;">{</span><span style="color: #a45bad;">0</span>, <span style="color: #a45bad;">false</span><span style="color: #67b11d;">}</span><span style="color: #2d9574;">)</span>;
    sm.process_event<span style="color: #2d9574;">(</span><span style="color: #a45bad;">events</span>::button<span style="color: #67b11d;">{</span><span style="color: #a45bad;">1</span>, <span style="color: #a45bad;">false</span><span style="color: #67b11d;">}</span><span style="color: #2d9574;">)</span>;
<span style="color: #bc6ec5;">}</span>
</pre>
</div>
</section>
<section id="slide-org5b2ea74">
<h3 id="org5b2ea74">Logging for free</h3>
<div class="org-src-container">

<pre  class="src src-C++"><span style="color: #4f97d7; font-weight: bold; font-style: italic;">namespace</span> <span style="color: #a45bad;">sml</span> = <span style="color: #a45bad;">boost</span>::sml;

<span style="color: #4f97d7; font-weight: bold; font-style: italic;">struct</span> <span style="color: #ce537a; font-weight: bold;">MyLogger</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold; font-style: italic;">template</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #4f97d7; font-weight: bold; font-style: italic;">class</span> <span style="color: #ce537a; font-weight: bold;">SM</span>, <span style="color: #4f97d7; font-weight: bold; font-style: italic;">class</span> <span style="color: #ce537a; font-weight: bold;">TEvent</span><span style="color: #bc6ec5;">&gt;</span>
    <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">log_process_event</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #ce537a; font-weight: bold;">TEvent</span>&amp;<span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        LOG<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"[%s][process_event] %s\n"</span>, <span style="color: #a45bad;">sml</span>::<span style="color: #a45bad;">aux</span>::get_type_name<span style="color: #67b11d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">SM</span><span style="color: #67b11d;">&gt;()</span>, <span style="color: #a45bad;">sml</span>::<span style="color: #a45bad;">aux</span>::get_type_name<span style="color: #67b11d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">TEvent</span><span style="color: #67b11d;">&gt;()</span><span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>

    <span style="color: #4f97d7; font-weight: bold; font-style: italic;">template</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #4f97d7; font-weight: bold; font-style: italic;">class</span> <span style="color: #ce537a; font-weight: bold;">SM</span>, <span style="color: #4f97d7; font-weight: bold; font-style: italic;">class</span> <span style="color: #ce537a; font-weight: bold;">TGuard</span>, <span style="color: #4f97d7; font-weight: bold; font-style: italic;">class</span> <span style="color: #ce537a; font-weight: bold;">TEvent</span><span style="color: #bc6ec5;">&gt;</span>
    <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">log_guard</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #ce537a; font-weight: bold;">TGuard</span>&amp;, <span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #ce537a; font-weight: bold;">TEvent</span>&amp;, <span style="color: #ce537a; font-weight: bold;">bool</span> <span style="color: #7590db;">result</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        LOG<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"[%s][guard] %s %s %s\n"</span>, <span style="color: #a45bad;">sml</span>::<span style="color: #a45bad;">aux</span>::get_type_name<span style="color: #67b11d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">SM</span><span style="color: #67b11d;">&gt;()</span>, <span style="color: #a45bad;">sml</span>::<span style="color: #a45bad;">aux</span>::get_type_name<span style="color: #67b11d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">TGuard</span><span style="color: #67b11d;">&gt;()</span>,
                <span style="color: #a45bad;">sml</span>::<span style="color: #a45bad;">aux</span>::get_type_name<span style="color: #67b11d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">TEvent</span><span style="color: #67b11d;">&gt;()</span>, <span style="color: #67b11d;">(</span>result ? <span style="color: #2d9574;">"[OK]"</span> : <span style="color: #2d9574;">"[Reject]"</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>

    <span style="color: #4f97d7; font-weight: bold; font-style: italic;">template</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #4f97d7; font-weight: bold; font-style: italic;">class</span> <span style="color: #ce537a; font-weight: bold;">SM</span>, <span style="color: #4f97d7; font-weight: bold; font-style: italic;">class</span> <span style="color: #ce537a; font-weight: bold;">TAction</span>, <span style="color: #4f97d7; font-weight: bold; font-style: italic;">class</span> <span style="color: #ce537a; font-weight: bold;">TEvent</span><span style="color: #bc6ec5;">&gt;</span>
    <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">log_action</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #ce537a; font-weight: bold;">TAction</span>&amp;, <span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #ce537a; font-weight: bold;">TEvent</span>&amp;<span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        LOG<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"[%s][action] %s %s\n"</span>, <span style="color: #a45bad;">sml</span>::<span style="color: #a45bad;">aux</span>::get_type_name<span style="color: #67b11d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">SM</span><span style="color: #67b11d;">&gt;()</span>, <span style="color: #a45bad;">sml</span>::<span style="color: #a45bad;">aux</span>::get_type_name<span style="color: #67b11d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">TAction</span><span style="color: #67b11d;">&gt;()</span>,
                <span style="color: #a45bad;">sml</span>::<span style="color: #a45bad;">aux</span>::get_type_name<span style="color: #67b11d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">TEvent</span><span style="color: #67b11d;">&gt;()</span><span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>

    <span style="color: #4f97d7; font-weight: bold; font-style: italic;">template</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #4f97d7; font-weight: bold; font-style: italic;">class</span> <span style="color: #ce537a; font-weight: bold;">SM</span>, <span style="color: #4f97d7; font-weight: bold; font-style: italic;">class</span> <span style="color: #ce537a; font-weight: bold;">TSrcState</span>, <span style="color: #4f97d7; font-weight: bold; font-style: italic;">class</span> <span style="color: #ce537a; font-weight: bold;">TDstState</span><span style="color: #bc6ec5;">&gt;</span>
    <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">log_state_change</span><span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #ce537a; font-weight: bold;">TSrcState</span>&amp; <span style="color: #7590db;">src</span>, <span style="color: #4f97d7; font-weight: bold; font-style: italic;">const</span> <span style="color: #ce537a; font-weight: bold;">TDstState</span>&amp; <span style="color: #7590db;">dst</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        LOG<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"[%s][transition] %s -&gt; %s\n"</span>, <span style="color: #a45bad;">sml</span>::<span style="color: #a45bad;">aux</span>::get_type_name<span style="color: #67b11d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">SM</span><span style="color: #67b11d;">&gt;()</span>, src.c_str<span style="color: #67b11d;">()</span>, dst.c_str<span style="color: #67b11d;">()</span><span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>;

<span style="color: #ce537a; font-weight: bold;">Logger</span> <span style="color: #7590db;">logger</span><span style="color: #4f97d7;">{}</span>;
<span style="color: #a45bad;">sml</span>::<span style="color: #ce537a; font-weight: bold;">sm</span><span style="color: #4f97d7;">&lt;</span>two_button_shutdown, <span style="color: #a45bad;">sml</span>::<span style="color: #ce537a; font-weight: bold;">logger</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">MyLogger</span><span style="color: #bc6ec5;">&gt;</span><span style="color: #4f97d7;">&gt;</span> <span style="color: #7590db;">sm</span><span style="color: #4f97d7;">{</span>logger<span style="color: #4f97d7;">}</span>;
</pre>
</div>
</section>
</section>
<section>
<section id="slide-org47443ba">
<h2 id="org47443ba">Questions?</h2>

<div class="figure">
<p><img src="img/wave_keyboard.jpg" alt="wave_keyboard.jpg" width="60%" height="60%" />
</p>
</div>
</section>
</section>
<section>
<section id="slide-org408963e">
<h2 id="org408963e">Resources</h2>
<ul>
<li><a href="https://en.cppreference.com/w/">C++ reference</a></li>
<li><a href="https://bitbashing.io/embedded-cpp.html">C++ on Embedded Systems</a></li>
<li><a href="https://www.youtube.com/playlist?list=PLs3KjaCtOwSZ2tbuV1hx8Xz-rFZTan2J1">C++ Weekly</a></li>
<li><a href="https://www.youtube.com/watch?v=c9Xt6Me3mJ4">Michael Caisse</a> on C++ in embedded systems</li>

</ul>
</section>
</section>
</div>
</div>
<script src="./lib/js/head.min.js"></script>
<script src="./js/reveal.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: false,
pdfSeparateFragments: true,

overview: true,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'none', // default/cube/page/concave/zoom/linear/fade/none
transitionSpeed: 'default',
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: './lib/js/classList.js', condition: function() { return !document.body.classList; } },
 { src: './plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: './plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: './plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: './plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]
});
</script>
</body>
</html>
